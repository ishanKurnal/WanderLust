<% layout("/layouts/boilerplate") %>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Dropdown for small screens -->
        <div class="dropdown d-md-none">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="categoryDropdownSmall" data-bs-toggle="dropdown" aria-expanded="false">
                Select Category
            </button>
            <ul class="dropdown-menu" aria-labelledby="categoryDropdownSmall">
                <li><a class="dropdown-item" href="/listings">All</a></li>
                <li><a class="dropdown-item" href="/listings?category=Trending">Trending</a></li>
                <li><a class="dropdown-item" href="/listings?category=Rooms">Rooms</a></li>
                <li><a class="dropdown-item" href="/listings?category=Iconic Cities">Iconic Cities</a></li>
                <li><a class="dropdown-item" href="/listings?category=Mountains">Mountains</a></li>
                <li><a class="dropdown-item" href="/listings?category=Castles">Castles</a></li>
                <li><a class="dropdown-item" href="/listings?category=Amazing Pools">Amazing Pools</a></li>
                <li><a class="dropdown-item" href="/listings?category=Camping">Camping</a></li>
                <li><a class="dropdown-item" href="/listings?category=Farms">Farms</a></li>
                <li><a class="dropdown-item" href="/listings?category=Arctic">Arctic</a></li>
                <li><a class="dropdown-item" href="/listings?category=Domes">Domes</a></li>
                <li><a class="dropdown-item" href="/listings?category=Boats">Boats</a></li>
            </ul>
        </div>

        <!-- Horizontal filters for medium and larger screens -->
        <div id="filters" class="d-none d-md-flex">
            <a href="/listings?category=Trending" class="filter-link">
                <div class="filter">
                    <div><i class="fa-solid fa-fire"></i></div>
                    <p>Trending</p>
                </div>
            </a>
            <a href="/listings?category=Rooms" class="filter-link">
                <div class="filter">
                    <div><i class="fa-solid fa-bed"></i></div>
                    <p>Rooms</p>
                </div>
            </a>
            <a href="/listings?category=Iconic Cities" class="filter-link">
                <div class="filter">
                    <i class="fa-solid fa-mountain-city"></i>
                    <p>Iconic Cities</p>
                </div>
            </a>
            <a href="/listings?category=Mountains" class="filter-link">
                <div class="filter">
                    <i class="fa-solid fa-mountain"></i>
                    <p>Mountains</p>
                </div>
            </a>
            <a href="/listings?category=Castles" class="filter-link">
                <div class="filter">
                    <i class="fa-brands fa-fort-awesome"></i>
                    <p>Castles</p>
                </div>
            </a>
            <a href="/listings?category=Amazing Pools" class="filter-link">
                <div class="filter">
                    <i class="fa-solid fa-person-swimming"></i>
                    <p>Amazing Pools</p>
                </div>
            </a>
            <a href="/listings?category=Camping" class="filter-link">
                <div class="filter">
                    <i class="fa-solid fa-campground"></i>
                    <p>Camping</p>
                </div>
            </a>
            <a href="/listings?category=Farms" class="filter-link">
                <div class="filter">
                    <i class="fa-solid fa-cow"></i>
                    <p>Farms</p>
                </div>
            </a>
            <a href="/listings?category=Arctic" class="filter-link">
                <div class="filter">
                    <i class="fa-regular fa-snowflake"></i>
                    <p>Arctic</p>
                </div>
            </a>
            <a href="/listings?category=Domes" class="filter-link">
                <div class="filter">
                    <i class="fa-solid fa-igloo"></i>
                    <p>Beach</p>
                </div>
            </a>
            <a href="/listings?category=Boats" class="filter-link">
                <div class="filter">
                    <i class="fa-solid fa-ship"></i>
                    <p>Boats</p>
                </div>
            </a>
        </div>

        <div class="tax-toggle">
            <div class="form-check-reverse form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                <label class="form-check-label" for="flexSwitchCheckCheckDefault"> Display total after taxes </label>
            </div>
        </div>
    </div>

    <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
        <% for (listing of allListings) { %>
            <a href="/listings/<%= listing._id %>" class="listing-link">
                <div class="card cols listing-card">
                    <img src="<%= listing.image.url %>" class="card-img-top" alt="<%= listing.image.filename %>" style="height: 20rem">
                    <div class="card-img-overlay"></div>
                    <div class="card-body">
                        <p class="card-text">
                            <b><%= listing.title %></b>
                            <br>
                            &#8377; <%= listing.price ? listing.price.toLocaleString("en-IN") : "Price not set" %> / night
                            <i class="tax-info">&nbsp; &nbsp;+18% GST</i>
                        </p>
                    </div>
                </div>
            </a>           
        <% } %>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const categoryParam = urlParams.get('category');
        const categoryDropdownButton = document.getElementById('categoryDropdownSmall');

        if (categoryParam && categoryDropdownButton) {
            const dropdownItems = document.querySelectorAll('#categoryDropdownSmall + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                const itemCategory = new URLSearchParams(item.href.split('?')[1]).get('category');
                if (itemCategory === categoryParam) {
                    categoryDropdownButton.textContent = item.textContent;
                } else if (categoryParam === 'all' && item.textContent === 'All') {
                    categoryDropdownButton.textContent = item.textContent;
                }
            });
        }
    });
</script>